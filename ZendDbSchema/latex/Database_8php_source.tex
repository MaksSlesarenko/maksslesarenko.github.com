\hypertarget{Database_8php}{\section{Database.\-php}
\label{Database_8php}\index{Db/\-Schema/\-Database.\-php@{Db/\-Schema/\-Database.\-php}}
}

\begin{DoxyCode}
00001 <?php
\hypertarget{Database_8php_source_l00029}{}\hyperlink{classZendDbSchema__Db__Schema__Database}{00029} \textcolor{keyword}{class }\hyperlink{classZendDbSchema__Db__Schema__Database}{ZendDbSchema\_Db\_Schema\_Database}
00030     \textcolor{keyword}{extends} \hyperlink{classZendDbSchema__Db__Schema__AbstractEntity}{ZendDbSchema\_Db\_Schema\_AbstractEntity}
00031 \{
00032     \textcolor{keyword}{const} CHARSET\_KEY = \textcolor{stringliteral}{'charset'};
00033 
00037     \textcolor{keyword}{protected} $\_loader;
00038 
\hypertarget{Database_8php_source_l00048}{}\hyperlink{classZendDbSchema__Db__Schema__Database_a922130cd70362866a2bd21d92131648e}{00048}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Schema__Database_a922130cd70362866a2bd21d92131648e}{\_\_construct}(
00049             $name = null,
00050             \hyperlink{interfaceZendDbSchema__Db__Adapter__SchemaCompatible}{ZendDbSchema\_Db\_Adapter\_SchemaCompatible}
        $adapter = null,
00051             \hyperlink{interfaceZendDbSchema__Db__Schema__Loader__Database}{ZendDbSchema\_Db\_Schema\_Loader\_Database}
          $loader = null,
00052             \hyperlink{interfaceZendDbSchema__Db__Schema__Generator__Database}{ZendDbSchema\_Db\_Schema\_Generator\_Database}
       $generator = null)
00053     \{
00054         \textcolor{keywordflow}{if} (!$adapter) \{
00055             $adapter = \hyperlink{classZendDbSchema__Db__Schema__AbstractEntity_aeeb617d5d385796ccbe95e0aa85cf491}{self::getDefaultAdapter}();
00056         \}
00057 
00058         \textcolor{keywordflow}{if} (!$loader || !$generator) \{
00059             \textcolor{keywordflow}{switch} (\textcolor{keyword}{true}) \{
00060                 \textcolor{keywordflow}{case} $adapter instanceof Zend\_Db\_Adapter\_Mysqli:
00061                 \textcolor{keywordflow}{case} $adapter instanceof Zend\_Db\_Adapter\_Pdo\_Mysql:
00062                     \textcolor{keywordflow}{if} (!$loader) \{
00063                         $loader = \textcolor{keyword}{new} 
      \hyperlink{classZendDbSchema__Db__Schema__Loader__Mysql__Database}{ZendDbSchema\_Db\_Schema\_Loader\_Mysql\_Database}
      ();
00064                     \}
00065                     \textcolor{keywordflow}{if} (!$generator) \{
00066                         $generator = \textcolor{keyword}{new} 
      \hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql__Database}{ZendDbSchema\_Db\_Schema\_Generator\_Mysql\_Database}
      ();
00067                     \}
00068                     \textcolor{keywordflow}{break};
00069             \}
00070         \}
00071         \textcolor{comment}{//TODO check that adapter, generator and loader are same type}
00072 
00073         $this->\_generator = $generator;
00074         $this->\_loader = $loader;
00075         $this->\_adapter = $adapter;
00076 
00077         \hyperlink{classZendDbSchema__Db__Schema__Database_a922130cd70362866a2bd21d92131648e}{parent::\_\_construct}($name);
00078     \}
00079 
\hypertarget{Database_8php_source_l00083}{}\hyperlink{classZendDbSchema__Db__Schema__Database_a4f5a636c4e7d8ab57f6e090cdf8841dc}{00083}     \textcolor{keyword}{protected} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Schema__Database_a4f5a636c4e7d8ab57f6e090cdf8841dc}{\_getAlterSql}()
00084     \{
00085         \textcolor{keywordflow}{return} $this->\hyperlink{classZendDbSchema__Db__Schema__AbstractEntity_a72a4acb81535f7110a49dfb3755ac48b}{getGenerator}()->alterDatabase($this);
00086     \}
00087 
\hypertarget{Database_8php_source_l00091}{}\hyperlink{classZendDbSchema__Db__Schema__Database_a48ad6cd38cc07c3c350335d21d7c11e9}{00091}     \textcolor{keyword}{protected} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Schema__Database_a48ad6cd38cc07c3c350335d21d7c11e9}{\_getCreateSql}()
00092     \{
00093         \textcolor{keywordflow}{return} $this->\hyperlink{classZendDbSchema__Db__Schema__AbstractEntity_a72a4acb81535f7110a49dfb3755ac48b}{getGenerator}()->createDatabase($this);
00094     \}
00095 
\hypertarget{Database_8php_source_l00099}{}\hyperlink{classZendDbSchema__Db__Schema__Database_ad0a851f47e7766bef9f0a54d01bffa6e}{00099}     \textcolor{keyword}{protected} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Schema__Database_ad0a851f47e7766bef9f0a54d01bffa6e}{\_getDropSql}()
00100     \{
00101         \textcolor{keywordflow}{return} $this->\hyperlink{classZendDbSchema__Db__Schema__AbstractEntity_a72a4acb81535f7110a49dfb3755ac48b}{getGenerator}()->dropDatabase($this);
00102     \}
00103 
\hypertarget{Database_8php_source_l00109}{}\hyperlink{classZendDbSchema__Db__Schema__Database_aad388b374fd5913946204230760b2d86}{00109}     \textcolor{keyword}{protected} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Schema__Database_aad388b374fd5913946204230760b2d86}{\_doReload}()
00110     \{
00111         $this->\_cleanSchema = $this->\_loader->load(
00112             $this->\hyperlink{classZendDbSchema__Db__Schema__AbstractEntity_ad6dfc39cc6d92633fd92170db18c9573}{getAdapter}(),
00113             $this->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_adacb1417b461310c5c87f72c459c1985}{getOriginName}()
00114         );
00115     \}
00116 
\hypertarget{Database_8php_source_l00123}{}\hyperlink{classZendDbSchema__Db__Schema__Database_acfc530f3381e35f7d57676c4dcff3620}{00123}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Schema__Database_acfc530f3381e35f7d57676c4dcff3620}{setCharset}($charset)
00124     \{
00125         $this->\hyperlink{classZendDbSchema__Db__Schema__Database_a16cacd680a6a027a88ec41f6d8211982}{\_\_set}(self::CHARSET\_KEY, (\textcolor{keywordtype}{string}) $charset);
00126         \textcolor{keywordflow}{return} $this;
00127     \}
00128 
\hypertarget{Database_8php_source_l00134}{}\hyperlink{classZendDbSchema__Db__Schema__Database_a71126f98bb7da60fcd0ac00c101467c8}{00134}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Schema__Database_a71126f98bb7da60fcd0ac00c101467c8}{getCharset}()
00135     \{
00136         \textcolor{keywordflow}{return} $this->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_a54d32c6f15463eaad2321a9f0e7225d7}{\_\_get}(self::CHARSET\_KEY);
00137     \}
00138 
\hypertarget{Database_8php_source_l00145}{}\hyperlink{classZendDbSchema__Db__Schema__Database_a16cacd680a6a027a88ec41f6d8211982}{00145}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Schema__Database_a16cacd680a6a027a88ec41f6d8211982}{\_\_set}($name, $value)
00146     \{
00147         \textcolor{keywordflow}{if} (self::NAME\_KEY == $name && $value) \{
00148             \textcolor{keywordflow}{if} ($this->\_name != $value && $this->\hyperlink{classZendDbSchema__Db__Schema__AbstractEntity_ad6dfc39cc6d92633fd92170db18c9573}{getAdapter}()->
      hasDatabase($value)) \{
00149                 \textcolor{keywordflow}{throw} \textcolor{keyword}{new} \hyperlink{classZendDbSchema__Db__Schema__Exception}{ZendDbSchema\_Db\_Schema\_Exception}
      (\textcolor{stringliteral}{"Database with name '\{$value\}' already exists"});
00150             \}
00151         \}
00152         \hyperlink{classZendDbSchema__Db__Schema__Database_a16cacd680a6a027a88ec41f6d8211982}{parent::\_\_set}($name, $value);
00153     \}
00154 \}
\end{DoxyCode}
