\hypertarget{Schema_2Validator_2Mysql_8php_source}{\section{\-Db/\-Schema/\-Validator/\-Mysql.php}
}

\begin{DoxyCode}
00001 <?php
\hypertarget{Schema_2Validator_2Mysql_8php_source_l00029}{}\hyperlink{classZendDbSchema__Db__Schema__Validator__Mysql}{00029} \textcolor{keyword}{class }\hyperlink{classZendDbSchema__Db__Schema__Validator__Mysql}{ZendDbSchema_Db_Schema_Validator_Mysql}
00030     \textcolor{keyword}{extends} \hyperlink{classZendDbSchema__Db__Schema__Validator__AbstractValidator}{ZendDbSchema_Db_Schema_Validator_AbstractValidator}
00031 \{
00035     \textcolor{keyword}{protected} $\_databaseEngines = array(
00036         \textcolor{stringliteral}{'MYISAM'},
00037         \textcolor{stringliteral}{'MEMORY'},
00038         \textcolor{stringliteral}{'INNODB'},
00039         \textcolor{stringliteral}{'FEDERATED'},
00040         \textcolor{stringliteral}{'BLACKHOLE'},
00041         \textcolor{stringliteral}{'MERGE'},
00042         \textcolor{stringliteral}{'EXAMPLE'},
00043         \textcolor{stringliteral}{'ARCHIVE'},
00044         \textcolor{stringliteral}{'CSV'}
00045     );
00046 
00050     \textcolor{keyword}{protected} $\_columnTypes = array(
00051         \textcolor{stringliteral}{'TINYINT'},
00052         \textcolor{stringliteral}{'SMALLINT'},
00053         \textcolor{stringliteral}{'MEDIUMINT'},
00054         \textcolor{stringliteral}{'INT'},
00055         \textcolor{stringliteral}{'INTEGER'},
00056         \textcolor{stringliteral}{'BIGINT'},
00057         \textcolor{stringliteral}{'FLOAT'},
00058         \textcolor{stringliteral}{'DOUBLE'},
00059         \textcolor{stringliteral}{'DECIMAL'},
00060         \textcolor{stringliteral}{'PRECISION'},
00061         \textcolor{stringliteral}{'REAL'},
00062         \textcolor{stringliteral}{'NUMERIC'},
00063 
00064         \textcolor{stringliteral}{'CHAR'},
00065         \textcolor{stringliteral}{'VARCHAR'},
00066         \textcolor{stringliteral}{'TINYTEXT'},
00067         \textcolor{stringliteral}{'TINYBLOB'},
00068         \textcolor{stringliteral}{'TEXT'},
00069         \textcolor{stringliteral}{'BLOB'},
00070         \textcolor{stringliteral}{'MEDIUMTEXT'},
00071         \textcolor{stringliteral}{'MEDIUMBLOB'},
00072         \textcolor{stringliteral}{'LONGTEXT'},
00073         \textcolor{stringliteral}{'LONGBLOB'},
00074 
00075         \textcolor{stringliteral}{'DATE'},
00076         \textcolor{stringliteral}{'DATETIME'},
00077         \textcolor{stringliteral}{'TIMESTAMP'},
00078         \textcolor{stringliteral}{'TIME'},
00079         \textcolor{stringliteral}{'YEAR'},
00080 
00081         \textcolor{stringliteral}{'ENUM'},
00082         \textcolor{stringliteral}{'SET'},
00083 
00084         \textcolor{stringliteral}{'BINARY'},
00085         \textcolor{stringliteral}{'VARBINARY'},
00086     );
00087 
00091     \textcolor{keyword}{protected} $\_tableIndexes = array(
00092         \textcolor{stringliteral}{'FULLTEXT'},
00093         \textcolor{stringliteral}{'UNIQUE'}
00094     );
00095 
\hypertarget{Schema_2Validator_2Mysql_8php_source_l00104}{}\hyperlink{classZendDbSchema__Db__Schema__Validator__Mysql_ab77a7fe20e34115d4b2679521b8918c0}{00104}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Schema__Validator__Mysql_ab77a7fe20e34115d4b2679521b8918c0}{validateDatabase}(\hyperlink{classZendDbSchema__Db__Schema__Database}{ZendDbSchema_Db_Schema_Database} $schema, 
      $option, $value)
00105     \{
00106         \textcolor{keywordflow}{if} ($option) \{
00107             \textcolor{keywordflow}{switch} ($option) \{
00108                 \textcolor{keywordflow}{case} \textcolor{stringliteral}{'name'}:
00109                     \textcolor{keywordflow}{if} (empty($value)) \{
00110                         \textcolor{keywordflow}{throw} \textcolor{keyword}{new} \hyperlink{classZendDbSchema__Db__Schema__Exception}{ZendDbSchema_Db_Schema_Exception}(\textcolor{stringliteral}{'Database
       name cannot be empty'});
00111                     \} elseif ($value !== $schema->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_adacb1417b461310c5c87f72c459c1985}{getOriginName}()) \{
00112                         \textcolor{keywordflow}{if} ($schema->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_a1680a8fd22360f74d29b641d7257a52f}{isExist}()) \{
00113                             \textcolor{keywordflow}{throw} \textcolor{keyword}{new} \hyperlink{classZendDbSchema__Db__Schema__Exception}{ZendDbSchema_Db_Schema_Exception}(
00114                                 \textcolor{stringliteral}{'Cannot rename existing database'}
00115                             );
00116                         \} elseif ($schema->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_a47d95912f6bf6d26d023597887dafacb}{getAdapter}()->hasDatabase($value)) \{
00117                             \textcolor{keywordflow}{throw} \textcolor{keyword}{new} \hyperlink{classZendDbSchema__Db__Schema__Exception}{ZendDbSchema_Db_Schema_Exception}(
00118                                 \textcolor{stringliteral}{"Database with name '\{$value\}' alteady exists"}
00119                             );
00120                         \}
00121                     \}
00122                     \textcolor{keywordflow}{break};
00123             \}
00124             \textcolor{keywordflow}{return} \textcolor{keyword}{true};
00125         \}
00126 
00127         \textcolor{keywordflow}{foreach} (array(\textcolor{stringliteral}{'name'}) as $option) \{
00128             $this->\hyperlink{classZendDbSchema__Db__Schema__Validator__Mysql_ab77a7fe20e34115d4b2679521b8918c0}{validateDatabase}($schema, $option, $schema->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_a54d32c6f15463eaad2321a9f0e7225d7}{__get}($option));
00129         \}
00130 
00131         \textcolor{keywordflow}{return} \textcolor{keyword}{true};
00132     \}
00133 
\hypertarget{Schema_2Validator_2Mysql_8php_source_l00142}{}\hyperlink{classZendDbSchema__Db__Schema__Validator__Mysql_a0c68fa05f88c3a6f603b04709133ef68}{00142}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Schema__Validator__Mysql_a0c68fa05f88c3a6f603b04709133ef68}{validateTable}(\hyperlink{classZendDbSchema__Db__Schema__Table}{ZendDbSchema_Db_Schema_Table} $schema, $option
      , $value)
00143     \{
00144         \textcolor{keywordflow}{if} ($option) \{
00145             \textcolor{keywordflow}{switch} ($option) \{
00146                 \textcolor{keywordflow}{case} \textcolor{stringliteral}{'name'}:
00147                     \textcolor{keywordflow}{if} (empty($value)) \{
00148                         \textcolor{keywordflow}{throw} \textcolor{keyword}{new} \hyperlink{classZendDbSchema__Db__Schema__Exception}{ZendDbSchema_Db_Schema_Exception}(\textcolor{stringliteral}{'Table name
       cannot be empty'});
00149                     \} elseif ($schema->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_a47d95912f6bf6d26d023597887dafacb}{getAdapter}()->hasTable($value) && $value
       != $schema->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_adacb1417b461310c5c87f72c459c1985}{getOriginName}()) \{
00150                         \textcolor{keywordflow}{throw} \textcolor{keyword}{new} \hyperlink{classZendDbSchema__Db__Schema__Exception}{ZendDbSchema_Db_Schema_Exception}(
00151                             \textcolor{stringliteral}{"Table with name '\{$value\}' alteady exists"}
00152                         );
00153                     \}
00154                     \textcolor{keywordflow}{break};
00155                 \textcolor{keywordflow}{case} \textcolor{stringliteral}{'engine'}:
00156                     \textcolor{keywordflow}{if} (!empty($value) && !in\_array(strtoupper($value), $this->
      \_engines)) \{
00157                         \textcolor{keywordflow}{throw} \textcolor{keyword}{new} \hyperlink{classZendDbSchema__Db__Schema__Exception}{ZendDbSchema_Db_Schema_Exception}(\textcolor{stringliteral}{"Unknown
       database engine '\{$value\}'"});
00158                     \}
00159                     \textcolor{keywordflow}{break};
00160             \}
00161             \textcolor{keywordflow}{return} \textcolor{keyword}{true};
00162         \}
00163 
00164         \textcolor{keywordflow}{foreach} (array(\textcolor{stringliteral}{'name'}, \textcolor{stringliteral}{'engine'}) as $option) \{
00165             $this->\hyperlink{classZendDbSchema__Db__Schema__Validator__Mysql_a0c68fa05f88c3a6f603b04709133ef68}{validateTable}($schema, $option, $schema->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_a54d32c6f15463eaad2321a9f0e7225d7}{__get}($option));
00166         \}
00167         \textcolor{keywordflow}{return} \textcolor{keyword}{true};
00168     \}
00169 
\hypertarget{Schema_2Validator_2Mysql_8php_source_l00178}{}\hyperlink{classZendDbSchema__Db__Schema__Validator__Mysql_a8dbce664f413a35abaf836233b4cc054}{00178}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Schema__Validator__Mysql_a8dbce664f413a35abaf836233b4cc054}{validateColumn}(\hyperlink{classZendDbSchema__Db__Schema__Table__Column}{ZendDbSchema_Db_Schema_Table_Column} $schema,
       $option, $value)
00179     \{
00180         \textcolor{keywordflow}{if} ($option) \{
00181             \textcolor{keywordflow}{switch} ($option) \{
00182                 \textcolor{keywordflow}{case} \textcolor{stringliteral}{'name'}:
00183                     \textcolor{keywordflow}{if} (empty($value)) \{
00184                         \textcolor{keywordflow}{throw} \textcolor{keyword}{new} \hyperlink{classZendDbSchema__Db__Schema__Exception}{ZendDbSchema_Db_Schema_Exception}(\textcolor{stringliteral}{'Column name
       cannot be empty'});
00185                     \} elseif ($schema->\hyperlink{classZendDbSchema__Db__Schema__Table__AbstractDefinition_a224b6a0c1df1d6ed40e03657782ef6fc}{getTable}()
00186                              && $value !== $schema->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_adacb1417b461310c5c87f72c459c1985}{getOriginName}()
00187                              && $schema->\hyperlink{classZendDbSchema__Db__Schema__Table__AbstractDefinition_a224b6a0c1df1d6ed40e03657782ef6fc}{getTable}()->columns()->has($value)) \{
00188                         \textcolor{keywordflow}{throw} \textcolor{keyword}{new} \hyperlink{classZendDbSchema__Db__Schema__Exception}{ZendDbSchema_Db_Schema_Exception}(\textcolor{stringliteral}{"Table
       already has column with name '\{$value\}'"});
00189                     \}
00190                     \textcolor{keywordflow}{break};
00191                 \textcolor{keywordflow}{case} \textcolor{stringliteral}{'type'}:
00192                     \textcolor{keywordflow}{if} (empty($value)) \{
00193                         \textcolor{keywordflow}{throw} \textcolor{keyword}{new} \hyperlink{classZendDbSchema__Db__Schema__Exception}{ZendDbSchema_Db_Schema_Exception}(\textcolor{stringliteral}{'Column type
       cannot be empty'});
00194                     \} elseif (!in\_array(strtoupper($value), $this->\_columnTypes
      )) \{
00195                         \textcolor{keywordflow}{throw} \textcolor{keyword}{new} \hyperlink{classZendDbSchema__Db__Schema__Exception}{ZendDbSchema_Db_Schema_Exception}(\textcolor{stringliteral}{"Unknown
       column type '\{$value\}'"});
00196                     \}
00197                     \textcolor{keywordflow}{break};
00198             \}
00199             \textcolor{keywordflow}{return} \textcolor{keyword}{true};
00200         \}
00201 
00202         \textcolor{keywordflow}{foreach} (array(\textcolor{stringliteral}{'name'}, \textcolor{stringliteral}{'type'}) as $option) \{
00203             $this->\hyperlink{classZendDbSchema__Db__Schema__Validator__Mysql_a8dbce664f413a35abaf836233b4cc054}{validateColumn}($schema, $option, $schema->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_a54d32c6f15463eaad2321a9f0e7225d7}{__get}($option));
00204         \}
00205 
00206         \textcolor{keywordflow}{return} \textcolor{keyword}{true};
00207     \}
00208 
\hypertarget{Schema_2Validator_2Mysql_8php_source_l00217}{}\hyperlink{classZendDbSchema__Db__Schema__Validator__Mysql_a0cf7ff88ff35c9636c0bb80f08416cb3}{00217}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Schema__Validator__Mysql_a0cf7ff88ff35c9636c0bb80f08416cb3}{validateIndex}(\hyperlink{classZendDbSchema__Db__Schema__Table__Index}{ZendDbSchema_Db_Schema_Table_Index} $schema, 
      $option, $value)
00218     \{
00219         \textcolor{keywordflow}{if} ($option) \{
00220             \textcolor{keywordflow}{switch} ($option) \{
00221                 \textcolor{keywordflow}{case} \textcolor{stringliteral}{'name'}:
00222                     \textcolor{keywordflow}{if} (empty($value)) \{
00223                         \textcolor{keywordflow}{throw} \textcolor{keyword}{new} \hyperlink{classZendDbSchema__Db__Schema__Exception}{ZendDbSchema_Db_Schema_Exception}(
00224                             \textcolor{stringliteral}{'Table index name cannot be empty'}
00225                         );
00226                     \} elseif ($schema->\hyperlink{classZendDbSchema__Db__Schema__Table__Index_a1a12fc2660c9e16579d6d8dbd7c57c3b}{getSchema}(\textcolor{stringliteral}{'name'})
00227                              && $schema->\hyperlink{classZendDbSchema__Db__Schema__Table__Index_a1a12fc2660c9e16579d6d8dbd7c57c3b}{getSchema}(\textcolor{stringliteral}{'name'}) != $value) \{
00228                         \textcolor{keywordflow}{throw} \textcolor{keyword}{new} \hyperlink{classZendDbSchema__Db__Schema__Exception}{ZendDbSchema_Db_Schema_Exception}(
00229                             \textcolor{stringliteral}{'Cannot change name of existing index'}
00230                         );
00231                     \}
00232                     \textcolor{keywordflow}{break};
00233                 \textcolor{keywordflow}{case} \textcolor{stringliteral}{'type'}:
00234                     \textcolor{keywordflow}{if} ($schema->\hyperlink{classZendDbSchema__Db__Schema__Table__Index_a1a12fc2660c9e16579d6d8dbd7c57c3b}{getSchema}(\textcolor{stringliteral}{'type'}) != $value) \{
00235                         \textcolor{keywordflow}{if} ($schema->\hyperlink{classZendDbSchema__Db__Schema__Table__Index_a1a12fc2660c9e16579d6d8dbd7c57c3b}{getSchema}(\textcolor{stringliteral}{'type'})) \{
00236                             \textcolor{keywordflow}{throw} \textcolor{keyword}{new} \hyperlink{classZendDbSchema__Db__Schema__Exception}{ZendDbSchema_Db_Schema_Exception}(
00237                                 \textcolor{stringliteral}{'Cannot change type of existing index'}
00238                             );
00239                         \} elseif (!in\_array(strtoupper($value), $this->
      \_tableIndexes)) \{
00240                             \textcolor{keywordflow}{throw} \textcolor{keyword}{new} \hyperlink{classZendDbSchema__Db__Schema__Exception}{ZendDbSchema_Db_Schema_Exception}(
00241                                 \textcolor{stringliteral}{"Unknown index type '\{$value\}'"}
00242                             );
00243                         \}
00244                     \}
00245                     \textcolor{keywordflow}{break};
00246 
00247 
00248             \}
00249             \textcolor{keywordflow}{return} \textcolor{keyword}{true};
00250         \}
00251 
00252         \textcolor{keywordflow}{foreach} (array(\textcolor{stringliteral}{'name'}, \textcolor{stringliteral}{'type'}) as $option) \{
00253             $this->\hyperlink{classZendDbSchema__Db__Schema__Validator__Mysql_a0cf7ff88ff35c9636c0bb80f08416cb3}{validateIndex}($schema, $option, $schema->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_a54d32c6f15463eaad2321a9f0e7225d7}{__get}($option));
00254         \}
00255 
00256         \textcolor{keywordflow}{return} \textcolor{keyword}{true};
00257     \}
00258 
\hypertarget{Schema_2Validator_2Mysql_8php_source_l00267}{}\hyperlink{classZendDbSchema__Db__Schema__Validator__Mysql_a68e9ec20adec3be1ac1494fb666f2acd}{00267}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Schema__Validator__Mysql_a68e9ec20adec3be1ac1494fb666f2acd}{validatePrimaryKey}(\hyperlink{classZendDbSchema__Db__Schema__Table__PrimaryKey}{ZendDbSchema_Db_Schema_Table_PrimaryKey} 
      $schema, $option, $value)
00268     \{
00269         \textcolor{keywordflow}{if} ($option) \{
00270             \textcolor{keywordflow}{switch} ($option) \{
00271                 \textcolor{keywordflow}{case} \textcolor{stringliteral}{'type'}:
00272                     \textcolor{keywordflow}{if} (\textcolor{stringliteral}{'primary'} != $value) \{
00273                         \textcolor{keywordflow}{throw} \textcolor{keyword}{new} \hyperlink{classZendDbSchema__Db__Schema__Exception}{ZendDbSchema_Db_Schema_Exception}(
00274                             \textcolor{stringliteral}{'Cannot change primary key type'}
00275                         );
00276                     \}
00277                     \textcolor{keywordflow}{break};
00278             \}
00279             \textcolor{keywordflow}{return} \textcolor{keyword}{true};
00280         \}
00281 
00282         \textcolor{keywordflow}{foreach} (array(\textcolor{stringliteral}{'type'}) as $option) \{
00283             $this->\hyperlink{classZendDbSchema__Db__Schema__Validator__Mysql_a0cf7ff88ff35c9636c0bb80f08416cb3}{validateIndex}($schema, $option, $schema->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_a54d32c6f15463eaad2321a9f0e7225d7}{__get}($option));
00284         \}
00285         \textcolor{keywordflow}{return} \textcolor{keyword}{true};
00286     \}
00287 
\hypertarget{Schema_2Validator_2Mysql_8php_source_l00296}{}\hyperlink{classZendDbSchema__Db__Schema__Validator__Mysql_a2c7ec868701fb965d57551639b637955}{00296}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Schema__Validator__Mysql_a2c7ec868701fb965d57551639b637955}{validateForeignKey}(\hyperlink{classZendDbSchema__Db__Schema__Table__ForeignKey}{ZendDbSchema_Db_Schema_Table_ForeignKey} 
      $schema, $option, $value)
00297     \{
00298         \textcolor{keywordflow}{return} \textcolor{keyword}{true};
00299     \}
00300 \}
\end{DoxyCode}
