\hypertarget{Schema_2Generator_2Mysql_8php_source}{\section{\-Db/\-Schema/\-Generator/\-Mysql.php}
}

\begin{DoxyCode}
00001 <?php
\hypertarget{Schema_2Generator_2Mysql_8php_source_l00029}{}\hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql}{00029} \textcolor{keyword}{class }\hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql}{ZendDbSchema_Db_Schema_Generator_Mysql}
00030     \textcolor{keyword}{implements} \hyperlink{interfaceZendDbSchema__Db__Schema__Generator__Interface}{ZendDbSchema_Db_Schema_Generator_Interface}
00031 \{
\hypertarget{Schema_2Generator_2Mysql_8php_source_l00038}{}\hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_a823d987af06bbcaa2142f2da3c6fd3c2}{00038}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_a823d987af06bbcaa2142f2da3c6fd3c2}{createDatabase}(\hyperlink{classZendDbSchema__Db__Schema__Database}{ZendDbSchema_Db_Schema_Database} $schema)
00039     \{
00040         $props = array();
00041 
00042         \textcolor{keywordflow}{if} ($schema->collate) \{
00043             $props[] = \textcolor{stringliteral}{"COLLATE "} . $schema->collate;
00044         \}
00045         \textcolor{keywordflow}{if} ($schema->\hyperlink{classZendDbSchema__Db__Schema__Database_a71126f98bb7da60fcd0ac00c101467c8}{getCharset}()) \{
00046             $props[] = \textcolor{stringliteral}{"DEFAULT CHARACTER SET "} . $schema->\hyperlink{classZendDbSchema__Db__Schema__Database_a71126f98bb7da60fcd0ac00c101467c8}{getCharset}();
00047         \}
00048 
00049         $name = $schema->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_a55787c21deddba427842809d589c2df6}{getName}();
00050 
00051         $query = array();
00052         $query[] = \textcolor{stringliteral}{"DROP DATABASE IF EXISTS `\{$name\}`"};
00053         $query[] = \textcolor{stringliteral}{"CREATE DATABASE `\{$name\}` "} . join(\textcolor{charliteral}{' '}, $props);
00054 
00055         \textcolor{keywordflow}{return} join(\textcolor{charliteral}{';'} . PHP\_EOL, $query);
00056     \}
00057 
\hypertarget{Schema_2Generator_2Mysql_8php_source_l00064}{}\hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_a5ffe10ce956b3e189c364d2bd03acf88}{00064}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_a5ffe10ce956b3e189c364d2bd03acf88}{alterDatabase}(\hyperlink{classZendDbSchema__Db__Schema__Database}{ZendDbSchema_Db_Schema_Database} $schema)
00065     \{
00066         \textcolor{keywordflow}{if} (!$schema->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_a1680a8fd22360f74d29b641d7257a52f}{isExist}()) \{
00067             \textcolor{keywordflow}{return} null;
00068         \}
00069 
00070         $props = array();
00071         \textcolor{keywordflow}{if} ($schema->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_ae859790a91bbcb9c4dc52a6139e5999e}{isDirty}(\textcolor{stringliteral}{'collate'})) \{
00072             $props[] = \textcolor{stringliteral}{"COLLATE "} . $schema->collate;
00073         \}
00074         \textcolor{keywordflow}{if} ($schema->\hyperlink{classZendDbSchema__Db__Schema__Database_a71126f98bb7da60fcd0ac00c101467c8}{getCharset}()) \{
00075             $props[] = \textcolor{stringliteral}{"DEFAULT CHARACTER SET "} . $schema->\hyperlink{classZendDbSchema__Db__Schema__Database_a71126f98bb7da60fcd0ac00c101467c8}{getCharset}();
00076         \}
00077 
00078         $query = \textcolor{stringliteral}{''};
00079         \textcolor{keywordflow}{if} (!empty($props)) \{
00080             $name = $schema->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_a55787c21deddba427842809d589c2df6}{getName}();
00081             $query = \textcolor{stringliteral}{"ALTER DATABASE `\{$name\}` "}.  join(\textcolor{charliteral}{' '}, $props);
00082         \}
00083         \textcolor{keywordflow}{return} $query;
00084     \}
00085 
\hypertarget{Schema_2Generator_2Mysql_8php_source_l00092}{}\hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_ab3c87af9fdc6ba8d911b1162a67dc0be}{00092}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_ab3c87af9fdc6ba8d911b1162a67dc0be}{dropDatabase}(\hyperlink{classZendDbSchema__Db__Schema__Database}{ZendDbSchema_Db_Schema_Database} $schema)
00093     \{
00094         \textcolor{keywordflow}{if} (!$schema->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_a1680a8fd22360f74d29b641d7257a52f}{isExist}()) \{
00095             \textcolor{keywordflow}{return} null;
00096         \}
00097         \textcolor{keywordflow}{return} \textcolor{stringliteral}{"DROP DATABASE IF EXISTS \{$schema->getOriginName()\}"};
00098     \}
00099 
\hypertarget{Schema_2Generator_2Mysql_8php_source_l00106}{}\hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_add2a0dcdb35c6ef230b09ad31d141b29}{00106}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_add2a0dcdb35c6ef230b09ad31d141b29}{createTable}(\hyperlink{classZendDbSchema__Db__Schema__Table}{ZendDbSchema_Db_Schema_Table} $schema)
00107     \{
00108         $name = $schema->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_a55787c21deddba427842809d589c2df6}{getName}();
00109 
00110         $engine = $schema->engine;
00111         \textcolor{keywordflow}{if} ($engine) \{
00112             $engine = \textcolor{stringliteral}{"ENGINE=\{$engine\}"};
00113         \}
00114 
00115         $charset = $schema->charset;
00116         \textcolor{keywordflow}{if} ($charset) \{
00117             $charset = \textcolor{stringliteral}{"DEFAULT CHARSET=\{$charset\}"};
00118         \}
00119 
00120         $query = array();
00121         \textcolor{keywordflow}{foreach} ($schema->\hyperlink{classZendDbSchema__Db__Schema__Table_a214354faa96de67a26b787c2c8741850}{columns}() as $column) \{
00122             $query[] = $column->toSql();
00123         \}
00124 
00125         $query = array\_filter($query);
00126         $query = join(\textcolor{stringliteral}{', '} . PHP\_EOL, $query);
00127 
00128         $query = \textcolor{stringliteral}{"DROP TABLE IF EXISTS `\{$name\}`;"} . PHP\_EOL
00129                . \textcolor{stringliteral}{"CREATE TABLE `\{$name\}` ("} . PHP\_EOL
00130                . $query . PHP\_EOL
00131                . \textcolor{stringliteral}{") \{$engine\} \{$charset\}"};
00132 
00133         \textcolor{keywordflow}{return} $query;
00134     \}
00135 
\hypertarget{Schema_2Generator_2Mysql_8php_source_l00142}{}\hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_aebe278ab07f38d58f8f440f9cad01565}{00142}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_aebe278ab07f38d58f8f440f9cad01565}{alterTable}(\hyperlink{classZendDbSchema__Db__Schema__Table}{ZendDbSchema_Db_Schema_Table} $schema)
00143     \{
00144         \textcolor{keywordflow}{if} (!$schema->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_a1680a8fd22360f74d29b641d7257a52f}{isExist}()) \{
00145             \textcolor{keywordflow}{return} null;
00146         \}
00147 
00148         $props = array();
00149         \textcolor{keywordflow}{if} ($schema->\hyperlink{classZendDbSchema__Db__Schema__Table_a21a2a75870207a989576655fec7507c3}{isDirty}(\textcolor{stringliteral}{'engine'})) \{
00150             $props[] = \textcolor{stringliteral}{"ENGINE=\{$schema->engine\}"};
00151         \}
00152 
00153         \textcolor{keywordflow}{if} ($schema->\hyperlink{classZendDbSchema__Db__Schema__Table_a21a2a75870207a989576655fec7507c3}{isDirty}(\textcolor{stringliteral}{'charset'})) \{
00154             $props[] = \textcolor{stringliteral}{"DEFAULT CHARSET=\{$schema->charset\}"};
00155         \}
00156 
00157         $props = array\_filter($props);
00158         $props = join(\textcolor{stringliteral}{', '} . PHP\_EOL, $props);
00159 
00160         $query = array();
00161 
00162         $name = $schema->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_a55787c21deddba427842809d589c2df6}{getName}();
00163         \textcolor{keywordflow}{if} ($schema->\hyperlink{classZendDbSchema__Db__Schema__Table_a21a2a75870207a989576655fec7507c3}{isDirty}(ZendDbSchema\_Db\_Schema\_Table::NAME\_KEY)) \{
00164             $oldName = $schema->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_adacb1417b461310c5c87f72c459c1985}{getOriginName}();
00165             \textcolor{keywordflow}{if} ($oldName && $oldName != $name) \{
00166                 $query[] = \textcolor{stringliteral}{"RENAME TABLE `\{$oldName\}` TO `\{$name\}`"};
00167             \}
00168         \}
00169         \textcolor{keywordflow}{if} ($props) \{
00170             $query[] = \textcolor{stringliteral}{"ALTER TABLE `\{$name\}` \{$props\}"};
00171         \}
00172 
00173         \textcolor{keywordflow}{return} join(\textcolor{charliteral}{';'} . PHP\_EOL, $query);
00174     \}
00175 
\hypertarget{Schema_2Generator_2Mysql_8php_source_l00182}{}\hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_a963a138b593e5e9e3a6b9a8e540a4a10}{00182}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_a963a138b593e5e9e3a6b9a8e540a4a10}{dropTable}(\hyperlink{classZendDbSchema__Db__Schema__Table}{ZendDbSchema_Db_Schema_Table} $schema)
00183     \{
00184         \textcolor{keywordflow}{if} (!$schema->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_a1680a8fd22360f74d29b641d7257a52f}{isExist}()) \{
00185             \textcolor{keywordflow}{return} null;
00186         \}
00187         \textcolor{keywordflow}{return} \textcolor{stringliteral}{"DROP TABLE IF EXISTS \{$schema->getOriginName()\}"};
00188     \}
00189 
\hypertarget{Schema_2Generator_2Mysql_8php_source_l00196}{}\hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_ab808aafb85b6359cacdb4cc3fe757d6b}{00196}     \textcolor{keyword}{protected} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_ab808aafb85b6359cacdb4cc3fe757d6b}{_columnSql}(\hyperlink{classZendDbSchema__Db__Schema__Table__Column}{ZendDbSchema_Db_Schema_Table_Column} $schema)
00197     \{
00198         $query = array();
00199 
00200         $query[] = $schema->type . \textcolor{stringliteral}{"(\{$schema->length\})"};
00201 
00202         \textcolor{keywordflow}{if} (!$schema->\hyperlink{classZendDbSchema__Db__Schema__Table__Column_aeeed5820cfc4fac67507a196e9faa638}{isNullable}()) \{
00203             $query[] = \textcolor{stringliteral}{"NOT NULL"};
00204         \} elseif (null === $schema->default) \{
00205 
00206             $query[] = \textcolor{stringliteral}{"DEFAULT NULL"};
00207         \}
00208 
00209         \textcolor{keywordflow}{if} (null !== $schema->default) \{
00210             $query[] = \textcolor{stringliteral}{"DEFAULT \{$schema->default\}"};
00211         \}
00212 
00213         $query[] = \textcolor{stringliteral}{"COMMENT '\{$schema->comment\}'"};
00214 
00215         \textcolor{keywordflow}{if} (\textcolor{keyword}{false} === $schema->\hyperlink{classZendDbSchema__Db__Schema__Table__Column_a49887d783c47fa509e229ca61dd113ef}{isSigned}()) \{
00216             $query[] = \textcolor{stringliteral}{"UNSIGNED"};
00217         \} elseif (\textcolor{keyword}{true} === $schema->\hyperlink{classZendDbSchema__Db__Schema__Table__Column_a49887d783c47fa509e229ca61dd113ef}{isSigned}()) \{
00218             $query[] = \textcolor{stringliteral}{"SIGNED"};
00219         \}
00220 
00221         \textcolor{keywordflow}{if} ($schema->autoincrement) \{
00222             $query[] = \textcolor{stringliteral}{"AUTO\_INCREMENT"};
00223         \}
00224 
00225         \textcolor{keywordflow}{if} ($schema->after) \{
00226             $query[] = \textcolor{stringliteral}{"AFTER \{$schema->after\}"};
00227         \}
00228 
00229         \textcolor{keywordflow}{return} join(\textcolor{charliteral}{' '}, $query);
00230     \}
00231 
\hypertarget{Schema_2Generator_2Mysql_8php_source_l00238}{}\hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_a86040ff7c424a0ad7e5f4aadeec20a4c}{00238}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_a86040ff7c424a0ad7e5f4aadeec20a4c}{createColumn}(\hyperlink{classZendDbSchema__Db__Schema__Table__Column}{ZendDbSchema_Db_Schema_Table_Column} $schema)
00239     \{
00240         $name = $schema->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_a55787c21deddba427842809d589c2df6}{getName}();
00241         \textcolor{keywordflow}{return} \textcolor{stringliteral}{"`\{$name\}`"} . \textcolor{charliteral}{' '} . $this->\hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_ab808aafb85b6359cacdb4cc3fe757d6b}{_columnSql}($schema);
00242     \}
00243 
\hypertarget{Schema_2Generator_2Mysql_8php_source_l00250}{}\hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_a57a5e637e2c19faee40597d96d6b71b3}{00250}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_a57a5e637e2c19faee40597d96d6b71b3}{alterColumn}(\hyperlink{classZendDbSchema__Db__Schema__Table__Column}{ZendDbSchema_Db_Schema_Table_Column} $schema)
00251     \{
00252         \textcolor{keywordflow}{if} (!$schema->\hyperlink{classZendDbSchema__Db__Schema__Table__AbstractDefinition_a224b6a0c1df1d6ed40e03657782ef6fc}{getTable}()->isExist() || !$schema->\hyperlink{classZendDbSchema__Db__Schema__Table__AbstractDefinition_a92b77fa23ce49db1c39edcc583ec6cfe}{isDirty}()) \{
00253             \textcolor{keywordflow}{return} null;
00254         \}
00255         $name   = $schema->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_a55787c21deddba427842809d589c2df6}{getName}();
00256 
00257         $query = array();
00258         $query[] = \textcolor{stringliteral}{"ALTER TABLE `\{$schema->getTable()->getName()\}`"};
00259 
00260         \textcolor{keywordflow}{if} ($schema->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_a1680a8fd22360f74d29b641d7257a52f}{isExist}()) \{
00261             $oldName = $schema->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_adacb1417b461310c5c87f72c459c1985}{getOriginName}();
00262             \textcolor{keywordflow}{if} ($oldName && $oldName != $name) \{
00263                 $oldName = $schema->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_adacb1417b461310c5c87f72c459c1985}{getOriginName}();
00264                 $query[] = \textcolor{stringliteral}{"CHANGE `\{$name\}` `\{$oldName\}`"};
00265             \} \textcolor{keywordflow}{else} \{
00266                 $query[] = \textcolor{stringliteral}{"MODIFY `\{$name\}`"};
00267             \}
00268         \} \textcolor{keywordflow}{else} \{
00269             $query[] = \textcolor{stringliteral}{"ADD `\{$name\}`"};
00270         \}
00271 
00272         \textcolor{keywordflow}{return} join(\textcolor{charliteral}{' '}, $query) . \textcolor{charliteral}{' '} . $this->\hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_ab808aafb85b6359cacdb4cc3fe757d6b}{_columnSql}($schema);
00273     \}
00274 
\hypertarget{Schema_2Generator_2Mysql_8php_source_l00281}{}\hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_a6fef0a3176c0e99d533b1790c7ae0301}{00281}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_a6fef0a3176c0e99d533b1790c7ae0301}{dropColumn}(\hyperlink{classZendDbSchema__Db__Schema__Table__Column}{ZendDbSchema_Db_Schema_Table_Column} $schema)
00282     \{
00283         $name   = $schema->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_a55787c21deddba427842809d589c2df6}{getName}();
00284         $table =  $schema->\hyperlink{classZendDbSchema__Db__Schema__Table__AbstractDefinition_a224b6a0c1df1d6ed40e03657782ef6fc}{getTable}()->getName();
00285 
00286         \textcolor{keywordflow}{return} \textcolor{stringliteral}{"ALTER TABLE \{$table\} DROP COLUMN \{$name\}"};
00287     \}
00288 
\hypertarget{Schema_2Generator_2Mysql_8php_source_l00295}{}\hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_a5546e56c0c78f9c9d3e830fb5ffcd72d}{00295}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_a5546e56c0c78f9c9d3e830fb5ffcd72d}{createIndex}(\hyperlink{classZendDbSchema__Db__Schema__Table__Index}{ZendDbSchema_Db_Schema_Table_Index} $schema)
00296     \{
00297         $name   = $schema->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_a55787c21deddba427842809d589c2df6}{getName}();
00298         $table =  $schema->\hyperlink{classZendDbSchema__Db__Schema__Table__AbstractDefinition_a224b6a0c1df1d6ed40e03657782ef6fc}{getTable}()->getName();
00299 
00300         $columns = \textcolor{stringliteral}{""};
00301         \textcolor{keywordflow}{if} ($schema->\hyperlink{classZendDbSchema__Db__Schema__Table__Index_ad0edf2869c08ce408566798f4305b8dc}{getColumns}()) \{
00302             $columns = \textcolor{stringliteral}{"("} . join(\textcolor{stringliteral}{', '}, $schema->\hyperlink{classZendDbSchema__Db__Schema__Table__Index_ad0edf2869c08ce408566798f4305b8dc}{getColumns}()) . \textcolor{stringliteral}{")"};
00303         \}
00304         $type = strtoupper($schema->type);
00305 
00306         $query = array();
00307         \textcolor{keywordflow}{if} ($schema->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_a1680a8fd22360f74d29b641d7257a52f}{isExist}()) \{
00308             $query[] = $this->\hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_a196fb89cf511d31c7124169247de1a6d}{dropIndex}($schema);
00309         \}
00310         $query[] = \textcolor{stringliteral}{"CREATE \{$type\} INDEX `\{$name\}` ON `\{$table\}` \{$columns\}"};
00311 
00312         \textcolor{keywordflow}{return} join(\textcolor{charliteral}{';'} . PHP\_EOL, $query);
00313     \}
00314 
\hypertarget{Schema_2Generator_2Mysql_8php_source_l00321}{}\hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_a0f94d6cabe125b387efa64fc7160a9e5}{00321}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_a0f94d6cabe125b387efa64fc7160a9e5}{alterIndex}(\hyperlink{classZendDbSchema__Db__Schema__Table__Index}{ZendDbSchema_Db_Schema_Table_Index} $schema)
00322     \{
00323         \textcolor{keywordflow}{return} $this->\hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_a5546e56c0c78f9c9d3e830fb5ffcd72d}{createIndex}($schema);
00324     \}
00325 
\hypertarget{Schema_2Generator_2Mysql_8php_source_l00332}{}\hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_a196fb89cf511d31c7124169247de1a6d}{00332}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_a196fb89cf511d31c7124169247de1a6d}{dropIndex}(\hyperlink{classZendDbSchema__Db__Schema__Table__Index}{ZendDbSchema_Db_Schema_Table_Index} $schema)
00333     \{
00334         $name   = $schema->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_a55787c21deddba427842809d589c2df6}{getName}();
00335         $table =  $schema->\hyperlink{classZendDbSchema__Db__Schema__Table__AbstractDefinition_a224b6a0c1df1d6ed40e03657782ef6fc}{getTable}()->getName();
00336 
00337         $query = \textcolor{stringliteral}{"DROP INDEX IF EXISTS `\{$name\}` ON `\{$table\}`"};
00338         \textcolor{keywordflow}{return} $query;
00339     \}
00340 
\hypertarget{Schema_2Generator_2Mysql_8php_source_l00347}{}\hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_ad1d5ebbad469fcd572d46f08f9f0e5ab}{00347}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_ad1d5ebbad469fcd572d46f08f9f0e5ab}{addPrimaryKey}(\hyperlink{classZendDbSchema__Db__Schema__Table__PrimaryKey}{ZendDbSchema_Db_Schema_Table_PrimaryKey} 
      $schema)
00348     \{
00349         $columns = join(\textcolor{stringliteral}{', '}, $schema->\hyperlink{classZendDbSchema__Db__Schema__Table__PrimaryKey_a228207d6e07e3ab95b8b25415077a6a1}{getColumns}());
00350         $table = $schema->\hyperlink{classZendDbSchema__Db__Schema__Table__AbstractDefinition_a224b6a0c1df1d6ed40e03657782ef6fc}{getTable}()->getName();
00351 
00352         $query = \textcolor{stringliteral}{"ALTER TABLE `\{$table\}` ADD PRIMARY KEY (\{$columns\})"};
00353 
00354         \textcolor{keywordflow}{return} $query;
00355     \}
00356 
\hypertarget{Schema_2Generator_2Mysql_8php_source_l00363}{}\hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_a2991a5e882a0b6015c0972668215d612}{00363}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_a2991a5e882a0b6015c0972668215d612}{alterPrimaryKey}(\hyperlink{classZendDbSchema__Db__Schema__Table__PrimaryKey}{ZendDbSchema_Db_Schema_Table_PrimaryKey} 
      $schema)
00364     \{
00365         $query = array();
00366         $query[] = $this->\hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_acc787f589296a3638f713b91456acafb}{dropPrimaryKey}($schema);
00367         $query[] = $this->\hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_ad1d5ebbad469fcd572d46f08f9f0e5ab}{addPrimaryKey}($schema);
00368 
00369         \textcolor{keywordflow}{return} join(\textcolor{charliteral}{';'} . PHP\_EOL, $query);
00370     \}
00371 
\hypertarget{Schema_2Generator_2Mysql_8php_source_l00378}{}\hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_acc787f589296a3638f713b91456acafb}{00378}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_acc787f589296a3638f713b91456acafb}{dropPrimaryKey}(\hyperlink{classZendDbSchema__Db__Schema__Table__PrimaryKey}{ZendDbSchema_Db_Schema_Table_PrimaryKey} 
      $schema)
00379     \{
00380         $table =  $schema->\hyperlink{classZendDbSchema__Db__Schema__Table__AbstractDefinition_a224b6a0c1df1d6ed40e03657782ef6fc}{getTable}()->getName();
00381 
00382         $query = \textcolor{stringliteral}{"ALTER TABLE `\{$table\}` DROP PRIMARY KEY"};
00383         \textcolor{keywordflow}{return} $query;
00384     \}
00385 
\hypertarget{Schema_2Generator_2Mysql_8php_source_l00392}{}\hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_a4b0c6d7fbd4d21f027facb6e495d1f6b}{00392}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_a4b0c6d7fbd4d21f027facb6e495d1f6b}{addForeignKey}(\hyperlink{classZendDbSchema__Db__Schema__Table__ForeignKey}{ZendDbSchema_Db_Schema_Table_ForeignKey} 
      $schema)
00393     \{
00394         $query = array();
00395 
00396         \textcolor{keywordflow}{if} ($name = $schema->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_adacb1417b461310c5c87f72c459c1985}{getOriginName}()) \{
00397             $query[] = \textcolor{stringliteral}{"CONSTRAINT \{$name\}"};
00398         \}
00399 
00400         $columns = $schema->\hyperlink{classZendDbSchema__Db__Schema__Table__ForeignKey_a5cd45e4bc92ac5975975753e459b4c8c}{getColumns}();
00401 
00402         $refColumns = join(\textcolor{stringliteral}{'`,`'}, array\_values($columns));
00403         $columns = join(\textcolor{stringliteral}{'`,`'}, array\_keys($columns));
00404         $refTable = $schema->\hyperlink{classZendDbSchema__Db__Schema__Table__ForeignKey_a39c9a3febcb98b77692566eed81220c7}{getReferences}();
00405 
00406         $query[] = \textcolor{stringliteral}{" FOREIGN KEY (`\{$columns\}`) REFERENCES `\{$refTable\}`
       (`\{$refColumns\}`)"};
00407 
00408         \textcolor{keywordflow}{if} ($delete = $schema->\hyperlink{classZendDbSchema__Db__Schema__Table__ForeignKey_a83644a5b874f111e17dbf08ffa3ea803}{getOnDelete}()) \{
00409             $query[] = \textcolor{stringliteral}{" ON DELETE \{$delete\}"};
00410         \}
00411         \textcolor{keywordflow}{if} ($update = $schema->\hyperlink{classZendDbSchema__Db__Schema__Table__ForeignKey_afb55f45baab8357ce8c295e4d71bf700}{getOnUpdate}()) \{
00412             $query[] = \textcolor{stringliteral}{" ON UPDATE \{$update\}"};
00413         \}
00414 
00415         $table =  $schema->\hyperlink{classZendDbSchema__Db__Schema__Table__AbstractDefinition_a224b6a0c1df1d6ed40e03657782ef6fc}{getTable}()->getName();
00416 
00417         \textcolor{keywordflow}{return} \textcolor{stringliteral}{"ALTER TABLE `\{$table\}` ADD "} . join(\textcolor{charliteral}{' '}, $query);
00418     \}
00419 
\hypertarget{Schema_2Generator_2Mysql_8php_source_l00426}{}\hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_a16b347a1c95888775b09d14505bae2b2}{00426}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_a16b347a1c95888775b09d14505bae2b2}{alterForeignKey}(\hyperlink{classZendDbSchema__Db__Schema__Table__ForeignKey}{ZendDbSchema_Db_Schema_Table_ForeignKey} 
      $schema)
00427     \{
00428         $query = array();
00429         \textcolor{keywordflow}{if} ($schema->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_a1680a8fd22360f74d29b641d7257a52f}{isExist}()) \{
00430             $query[] = $this->\hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_afa7990c889464576d30d4a110e9b0fac}{dropForeignKey}($schema);
00431         \}
00432         $query[] = $this->\hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_a4b0c6d7fbd4d21f027facb6e495d1f6b}{addForeignKey}($schema);
00433         \textcolor{keywordflow}{return} join(\textcolor{charliteral}{';'} . PHP\_EOL, $query);
00434     \}
00435 
\hypertarget{Schema_2Generator_2Mysql_8php_source_l00442}{}\hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_afa7990c889464576d30d4a110e9b0fac}{00442}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Schema__Generator__Mysql_afa7990c889464576d30d4a110e9b0fac}{dropForeignKey}(\hyperlink{classZendDbSchema__Db__Schema__Table__ForeignKey}{ZendDbSchema_Db_Schema_Table_ForeignKey} 
      $schema)
00443     \{
00444         $table =  $schema->\hyperlink{classZendDbSchema__Db__Schema__Table__AbstractDefinition_a224b6a0c1df1d6ed40e03657782ef6fc}{getTable}()->getName();
00445         $name = $schema->\hyperlink{classZendDbSchema__Db__Schema__AbstractSchema_adacb1417b461310c5c87f72c459c1985}{getOriginName}();
00446 
00447         $query = \textcolor{stringliteral}{"ALTER TABLE `\{$table\}` DROP FOREIGN KEY \{$name\}"};
00448         \textcolor{keywordflow}{return} $query;
00449     \}
00450 \}
\end{DoxyCode}
