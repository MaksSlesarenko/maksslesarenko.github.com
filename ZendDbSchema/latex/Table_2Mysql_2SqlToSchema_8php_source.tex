\hypertarget{Table_2Mysql_2SqlToSchema_8php}{\section{Sql\-To\-Schema.\-php}
\label{Table_2Mysql_2SqlToSchema_8php}\index{Filter/\-Db/\-Schema/\-Table/\-Mysql/\-Sql\-To\-Schema.\-php@{Filter/\-Db/\-Schema/\-Table/\-Mysql/\-Sql\-To\-Schema.\-php}}
}

\begin{DoxyCode}
00001 <?php
\hypertarget{Table_2Mysql_2SqlToSchema_8php_source_l00029}{}\hyperlink{classZendDbSchema__Filter__Db__Schema__Table__Mysql__SqlToSchema}{00029} \textcolor{keyword}{class }\hyperlink{classZendDbSchema__Filter__Db__Schema__Table__Mysql__SqlToSchema}{ZendDbSchema\_Filter\_Db\_Schema\_Table\_Mysql\_SqlToSchema}
00030     \textcolor{keyword}{implements} Zend\_Filter\_Interface
00031 \{
00035     \textcolor{keyword}{protected} $\_asObject;
00036 
\hypertarget{Table_2Mysql_2SqlToSchema_8php_source_l00042}{}\hyperlink{classZendDbSchema__Filter__Db__Schema__Table__Mysql__SqlToSchema_a0c87b613b451cbe6675fbe3ab95f9eac}{00042}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Filter__Db__Schema__Table__Mysql__SqlToSchema_a0c87b613b451cbe6675fbe3ab95f9eac}{\_\_construct}($asObject = \textcolor{keyword}{true})
00043     \{
00044         $this->\_asObject = (bool) $asObject;
00045     \}
00046 
\hypertarget{Table_2Mysql_2SqlToSchema_8php_source_l00053}{}\hyperlink{classZendDbSchema__Filter__Db__Schema__Table__Mysql__SqlToSchema_a90a7b3eac407b41ffb67b6ea297378b9}{00053}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Filter__Db__Schema__Table__Mysql__SqlToSchema_a90a7b3eac407b41ffb67b6ea297378b9}{filter}($value)
00054     \{
00055         $schema = array();
00056         \textcolor{keywordflow}{if} (!empty($value)) \{
00057             $data = explode(PHP\_EOL, $value);
00058             $data = array\_map(\textcolor{stringliteral}{'trim'}, $data);
00059 
00060             $tableName = array\_shift($data);
00061             \textcolor{keywordflow}{if} (preg\_match(\textcolor{stringliteral}{'|CREATE TABLE `([\(\backslash\)w\(\backslash\)d\(\backslash\)\_\(\backslash\)-]+)|i'}, $tableName, 
      $matches)) \{
00062                 $schema[ZendDbSchema\_Db\_Schema\_Table::NAME\_KEY] = $matches[\textcolor{charliteral}{'1'}]
      ;
00063             \}
00064 
00065             $tableInfo = array\_pop($data);
00066             \textcolor{keywordflow}{if} (preg\_match(\textcolor{stringliteral}{'|ENGINE=(\(\backslash\)w+)|i'}, $tableInfo, $matches)) \{
00067                 $schema[\textcolor{stringliteral}{'engine'}] = $matches[\textcolor{charliteral}{'1'}];
00068             \}
00069             \textcolor{keywordflow}{if} (preg\_match(\textcolor{stringliteral}{'|CHARSET=([\(\backslash\)w\(\backslash\)d\(\backslash\)\_\(\backslash\)-]+)|i'}, $tableInfo, $matches)) \{
00070                 $schema[ZendDbSchema\_Db\_Schema\_Table::CHARSET\_KEY] = $matches[\textcolor{charliteral}{
      '1'}];
00071             \}
00072 
00073             $schema[ZendDbSchema\_Db\_Schema\_Table::COLUMNS\_KEY] = array();
00074             $schema[ZendDbSchema\_Db\_Schema\_Table::INDEXES\_KEY]   = array();
00075             $schema[ZendDbSchema\_Db\_Schema\_Table::FOREIGNS\_KEY] = array();
00076 
00077             \textcolor{keywordflow}{foreach} ($data as $row) \{
00078                 $row = trim($row, \textcolor{stringliteral}{","});
00079 
00080                 \textcolor{keywordflow}{if} (0 === stripos($row, \textcolor{stringliteral}{'PRIMARY KEY'})) \{
00081                     preg\_match\_all(\textcolor{stringliteral}{'|\(\backslash\)w+|'}, substr($row, 14), $matches);
00082                     $schema[ZendDbSchema\_Db\_Schema\_Table::PRIMARY\_KEY] = array(
00083                         ZendDbSchema\_Db\_Schema\_Table\_PrimaryKey::NAME\_KEY    =>
       \textcolor{stringliteral}{'primary'},
00084                         ZendDbSchema\_Db\_Schema\_Table\_PrimaryKey::TYPE\_KEY    =>
       \textcolor{stringliteral}{'primary'},
00085                         ZendDbSchema\_Db\_Schema\_Table\_PrimaryKey::COLUMNS\_KEY =>
       $matches[\textcolor{charliteral}{'0'}]
00086                     );
00087                 \} elseif (0 === stripos($row, \textcolor{stringliteral}{'FULLTEXT'})) \{
00088                     $row = preg\_replace(\textcolor{stringliteral}{'/^FULLTEXT (KEY|INDEX)?/i'}, \textcolor{stringliteral}{''}, $row, 
      1);
00089                     preg\_match\_all(\textcolor{stringliteral}{'|\(\backslash\)w+|'}, $row, $matches);
00090                     $name = array\_shift($matches[\textcolor{charliteral}{'0'}]);
00091                     $schema[ZendDbSchema\_Db\_Schema\_Table::INDEXES\_KEY][$name] =
       array(
00092                         ZendDbSchema\_Db\_Schema\_Table\_Index::NAME\_KEY    => 
      $name,
00093                         ZendDbSchema\_Db\_Schema\_Table\_Index::TYPE\_KEY    => \textcolor{stringliteral}{'
      fulltext'},
00094                         ZendDbSchema\_Db\_Schema\_Table\_Index::COLUMNS\_KEY => 
      $matches[\textcolor{charliteral}{'0'}]
00095                     );
00096                 \} elseif (0 === stripos($row, \textcolor{stringliteral}{'UNIQUE'})) \{
00097                     $row = preg\_replace(\textcolor{stringliteral}{'/^UNIQUE (KEY|INDEX)?/i'}, \textcolor{stringliteral}{''}, $row, 1)
      ;
00098                     preg\_match\_all(\textcolor{stringliteral}{'|\(\backslash\)w+|'}, $row, $matches);
00099                     $name = array\_shift($matches[\textcolor{charliteral}{'0'}]);
00100                     $schema[ZendDbSchema\_Db\_Schema\_Table::INDEXES\_KEY][$name] =
       array(
00101                         ZendDbSchema\_Db\_Schema\_Table\_Index::NAME\_KEY    => 
      $name,
00102                         ZendDbSchema\_Db\_Schema\_Table\_Index::TYPE\_KEY    => \textcolor{stringliteral}{'
      unique'},
00103                         ZendDbSchema\_Db\_Schema\_Table\_Index::COLUMNS\_KEY => 
      $matches[\textcolor{charliteral}{'0'}]
00104                     );
00105                 \} elseif (0 === stripos($row, \textcolor{stringliteral}{'CONSTRAINT'})) \{
00106                     preg\_match(\textcolor{stringliteral}{'|CONSTRAINT ?`(\(\backslash\)w+)|i'}, $row, $matches);
00107 
00108                     $keyName = $matches[\textcolor{charliteral}{'1'}];
00109                     $key = array();
00110 
00111                     \textcolor{keywordflow}{if} (preg\_match\_all(\textcolor{stringliteral}{'|\(\backslash\)([^)]*\(\backslash\))|i'}, $row, $matches)) \{
00112 
00113                         $columns = $matches[\textcolor{charliteral}{'0'}][\textcolor{charliteral}{'0'}];
00114                         $refColumns = $matches[\textcolor{charliteral}{'0'}][\textcolor{charliteral}{'1'}];
00115 
00116                         preg\_match\_all(\textcolor{stringliteral}{'|\(\backslash\)w+|i'}, $columns, $matches);
00117                         $columns = $matches[\textcolor{charliteral}{'0'}];
00118                         preg\_match\_all(\textcolor{stringliteral}{'|\(\backslash\)w+|i'}, $refColumns, $matches);
00119                         $refColumns = $matches[\textcolor{charliteral}{'0'}];
00120                         $key[
      ZendDbSchema\_Db\_Schema\_Table\_ForeignKey::COLUMNS\_KEY] = array\_combine($columns, $refColumns);
00121                     \}
00122                     \textcolor{keywordflow}{if} (preg\_match(\textcolor{stringliteral}{'|REFERENCES ?`(\(\backslash\)w+)|i'}, $row, $matches)) \{
00123                         $key[
      ZendDbSchema\_Db\_Schema\_Table\_ForeignKey::REFERENCE\_KEY] = $matches[\textcolor{charliteral}{'1'}];
00124                     \}
00125                     \textcolor{keywordflow}{if} (preg\_match(\textcolor{stringliteral}{'|ON DELETE (\(\backslash\)w+)|i'}, $row, $matches)) \{
00126                         $key[
      ZendDbSchema\_Db\_Schema\_Table\_ForeignKey::ONDELETE\_KEY] = $matches[\textcolor{charliteral}{'1'}];
00127                     \}
00128                     \textcolor{keywordflow}{if} (preg\_match(\textcolor{stringliteral}{'|ON UPDATE (\(\backslash\)w+)|i'}, $row, $matches)) \{
00129                         $key[
      ZendDbSchema\_Db\_Schema\_Table\_ForeignKey::ONUPDATE\_KEY] = $matches[\textcolor{charliteral}{'1'}];
00130                     \}
00131 
00132                     $schema[ZendDbSchema\_Db\_Schema\_Table::FOREIGNS\_KEY][
      $keyName] = $key;
00133                 \} elseif (0 === stripos($row, \textcolor{charliteral}{'`'})) \{
00134                     $key = array(
00135                         \textcolor{stringliteral}{'type'}     => null,
00136                         \textcolor{stringliteral}{'default'}  => null,
00137                         \textcolor{stringliteral}{'nullable'} => null,
00138                         \textcolor{stringliteral}{'signed'} => null,
00139                         \textcolor{stringliteral}{'comment'}  => null,
00140                     );
00141                     \textcolor{keywordflow}{if} (preg\_match(\textcolor{stringliteral}{'|DEFAULT (\(\backslash\)w+)|i'}, $row, $matches)) \{
00142                         $key[\textcolor{stringliteral}{'default'}] = $matches[\textcolor{charliteral}{'1'}];
00143                     \}
00144                     \textcolor{keywordflow}{if} (preg\_match(\textcolor{stringliteral}{'|COMMENT \(\backslash\)'([^\(\backslash\)']+)\(\backslash\)'|i'}, $row, $matches)) 
      \{
00145                         $key[\textcolor{stringliteral}{'comment'}] = $matches[\textcolor{charliteral}{'1'}];
00146                     \}
00147                     \textcolor{keywordflow}{if} (preg\_match(\textcolor{stringliteral}{'|NOT NULL|i'}, $row, $matches)) \{
00148                         $key[\textcolor{stringliteral}{'nullable'}] = \textcolor{keyword}{false};
00149                     \} \textcolor{keywordflow}{else} \{
00150                         $key[\textcolor{stringliteral}{'nullable'}] = \textcolor{keyword}{true};
00151                     \}
00152                     \textcolor{keywordflow}{if} (preg\_match(\textcolor{stringliteral}{'|AUTO\_INCREMENT|i'}, $row, $matches)) \{
00153                         $key[\textcolor{stringliteral}{'autoincrement'}] = \textcolor{keyword}{true};
00154                     \}
00155                     \textcolor{keywordflow}{if} (preg\_match(\textcolor{stringliteral}{'|^`(\(\backslash\)w+)` (\(\backslash\)w+)\(\backslash\)((\(\backslash\)d+)\(\backslash\))|i'}, $row, $matches
      )) \{
00156                         $key[\textcolor{stringliteral}{'type'}] = $matches[\textcolor{charliteral}{'2'}];
00157                         $key[\textcolor{stringliteral}{'length'}] = $matches[\textcolor{charliteral}{'3'}];
00158                         $keyName = $matches[\textcolor{charliteral}{'1'}];
00159                         $schema[ZendDbSchema\_Db\_Schema\_Table::COLUMNS\_KEY][
      $keyName] = $key;
00160                     \}
00161                 \}
00162             \}
00163         \}
00164         \textcolor{keywordflow}{if} (!$this->\_asObject) \{
00165             \textcolor{keywordflow}{return} $schema;
00166         \}
00167         \textcolor{keywordflow}{return} \textcolor{keyword}{new} \hyperlink{classZendDbSchema__Db__Schema__Table}{ZendDbSchema\_Db\_Schema\_Table}(
      $schema[ZendDbSchema\_Db\_Schema\_Table::NAME\_KEY], $schema);
00168     \}
00169 \}
\end{DoxyCode}
