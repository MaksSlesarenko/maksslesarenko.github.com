\hypertarget{Skeleton_8php}{\section{Skeleton.\-php}
\label{Skeleton_8php}\index{Db/\-Migration/\-Skeleton.\-php@{Db/\-Migration/\-Skeleton.\-php}}
}

\begin{DoxyCode}
00001 <?php
\hypertarget{Skeleton_8php_source_l00029}{}\hyperlink{classZendDbSchema__Db__Migration__Skeleton}{00029} \textcolor{keyword}{class }\hyperlink{classZendDbSchema__Db__Migration__Skeleton}{ZendDbSchema\_Db\_Migration\_Skeleton}
00030 \{
00034     \textcolor{keyword}{protected} $\_adapter;
00035 
00039     \textcolor{keyword}{protected} $\_version;
00040 
00044     \textcolor{keyword}{protected} $\_class;
00045 
\hypertarget{Skeleton_8php_source_l00051}{}\hyperlink{classZendDbSchema__Db__Migration__Skeleton_a9cca04ca87612733692005f53cae10e6}{00051}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Migration__Skeleton_a9cca04ca87612733692005f53cae10e6}{\_\_construct}(Zend\_CodeGenerator\_Php\_Class $class 
      = null)
00052     \{
00053         \textcolor{keywordflow}{if} (!$class) \{
00054             $class = \textcolor{keyword}{new} Zend\_CodeGenerator\_Php\_Class();
00055         \}
00056         $class->setExtendedClass(\textcolor{stringliteral}{'ZendDbSchema\_Db\_Migration\_Change'});
00057 
00058         $this->\_class = $class;
00059     \}
00060 
\hypertarget{Skeleton_8php_source_l00066}{}\hyperlink{classZendDbSchema__Db__Migration__Skeleton_a54863ab7a0d3e0c7c2492ced1507c42b}{00066}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Migration__Skeleton_a54863ab7a0d3e0c7c2492ced1507c42b}{setMethodUp}($body = \textcolor{stringliteral}{'// rollup'})
00067     \{
00068         $up = \textcolor{keyword}{new} Zend\_CodeGenerator\_Php\_Method();
00069         $up->setName(\textcolor{stringliteral}{'up'})->setBody($body);
00070 
00071         $this->\_class->setMethod($up);
00072     \}
00073 
\hypertarget{Skeleton_8php_source_l00079}{}\hyperlink{classZendDbSchema__Db__Migration__Skeleton_a696ff29e0bfca02bd31d6c4e82af58f7}{00079}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Migration__Skeleton_a696ff29e0bfca02bd31d6c4e82af58f7}{setMethodDown}($body = \textcolor{stringliteral}{'// rolldown'})
00080     \{
00081         $down = \textcolor{keyword}{new} Zend\_CodeGenerator\_Php\_Method();
00082         $down->setName(\textcolor{stringliteral}{'down'})->setBody($body);
00083 
00084         $this->\_class->setMethod($down);
00085     \}
00086 
\hypertarget{Skeleton_8php_source_l00093}{}\hyperlink{classZendDbSchema__Db__Migration__Skeleton_a58a0cbc3ea2139c107db1c19d4a6b60d}{00093}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Migration__Skeleton_a58a0cbc3ea2139c107db1c19d4a6b60d}{addSchema}(array $tablesList = array(), array 
      $databasesList = array())
00094     \{
00095         \textcolor{keywordflow}{if} (empty($databasesList)) \{
00096             $config = $this->\hyperlink{classZendDbSchema__Db__Migration__Skeleton_a1d08bca816aaff3ac27087d5e5daa2ff}{getAdapter}()->getConfig();
00097             $databasesList[] = $config[\textcolor{stringliteral}{'dbname'}];
00098         \}
00099         $databasesConfig = array();
00100         \textcolor{keywordflow}{foreach} ($databasesList as $database) \{
00101             $schema = \textcolor{keyword}{new} \hyperlink{classZendDbSchema__Db__Schema__Database}{ZendDbSchema\_Db\_Schema\_Database}
      ($database);
00102             $databasesConfig[$database] = $schema->toArray();
00103         \}
00104 
00105         $databases = \textcolor{keyword}{new} Zend\_CodeGenerator\_Php\_Property();
00106         $databases->setName(\textcolor{stringliteral}{'\_databasesConfig'})
00107                   ->setVisibility(
      Zend\_CodeGenerator\_Php\_Property::VISIBILITY\_PROTECTED)
00108                   ->setDefaultValue($databasesConfig)
00109                   ->setDocBlock(\textcolor{stringliteral}{"Databases configuration \(\backslash\)n@var array"});
00110 
00111         $this->\_class->setProperty($databases);
00112 
00113         \textcolor{keywordflow}{if} (!empty($tablesList)) \{
00114             $tablesList = array\_intersect(
00115                     $this->\hyperlink{classZendDbSchema__Db__Migration__Skeleton_a1d08bca816aaff3ac27087d5e5daa2ff}{getAdapter}()->listTables(),
00116                     $tablesList
00117             );
00118         \} \textcolor{keywordflow}{else} \{
00119             $tablesList = $this->\hyperlink{classZendDbSchema__Db__Migration__Skeleton_a1d08bca816aaff3ac27087d5e5daa2ff}{getAdapter}()->listTables();
00120         \}
00121 
00122         $tablesConfig = array();
00123         \textcolor{keywordflow}{foreach} ($tablesList as $table) \{
00124             $schema = \textcolor{keyword}{new} \hyperlink{classZendDbSchema__Db__Schema__Table}{ZendDbSchema\_Db\_Schema\_Table}
      ($table);
00125             $tablesConfig[$table] = $schema->toArray();
00126         \}
00127         $tables = \textcolor{keyword}{new} Zend\_CodeGenerator\_Php\_Property();
00128         $tables->setName(\textcolor{stringliteral}{'\_tablesConfig'})
00129                ->setVisibility(
      Zend\_CodeGenerator\_Php\_Property::VISIBILITY\_PROTECTED)
00130                ->setDefaultValue($tablesConfig)
00131                ->setDocBlock(\textcolor{stringliteral}{"Tables configuration \(\backslash\)n@var array"});
00132 
00133         $this->\_class->setProperty($tables);
00134     \}
00135 
\hypertarget{Skeleton_8php_source_l00142}{}\hyperlink{classZendDbSchema__Db__Migration__Skeleton_a7613e2ec6a61b621fd7897a29934269d}{00142}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Migration__Skeleton_a7613e2ec6a61b621fd7897a29934269d}{setVersion}($version)
00143     \{
00144         $this->\_version = rtrim($version, \textcolor{stringliteral}{'.php'});
00145 
00146         $this->\hyperlink{classZendDbSchema__Db__Migration__Skeleton_a9d8f00f78a02bdc4e028a210c2797c62}{getClass}()->setName(self::getClassName($version));
00147 
00148         \textcolor{keywordflow}{return} $this;
00149     \}
00150 
\hypertarget{Skeleton_8php_source_l00156}{}\hyperlink{classZendDbSchema__Db__Migration__Skeleton_afb677840482d948597ec10dc0fd37aab}{00156}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Migration__Skeleton_afb677840482d948597ec10dc0fd37aab}{getVersion}()
00157     \{
00158         \textcolor{keywordflow}{if} (!$this->\_version) \{
00159             $this->\hyperlink{classZendDbSchema__Db__Migration__Skeleton_a7613e2ec6a61b621fd7897a29934269d}{setVersion}(self::generateVersion());
00160         \}
00161         \textcolor{keywordflow}{return} $this->\_version;
00162     \}
00163 
\hypertarget{Skeleton_8php_source_l00169}{}\hyperlink{classZendDbSchema__Db__Migration__Skeleton_a061e25b67825b88e94acf79944db19a6}{00169}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Migration__Skeleton_a061e25b67825b88e94acf79944db19a6}{getFile}()
00170     \{
00171         $file = \textcolor{keyword}{new} Zend\_CodeGenerator\_Php\_File();
00172         $file->setClass($this->\hyperlink{classZendDbSchema__Db__Migration__Skeleton_a9d8f00f78a02bdc4e028a210c2797c62}{getClass}());
00173         $file->setFilename(self::getFilename($this->\hyperlink{classZendDbSchema__Db__Migration__Skeleton_afb677840482d948597ec10dc0fd37aab}{getVersion}()));
00174 
00175         \textcolor{keywordflow}{return} $file;
00176     \}
00177 
\hypertarget{Skeleton_8php_source_l00183}{}\hyperlink{classZendDbSchema__Db__Migration__Skeleton_a71668c68edcf35f36f111963a9b625df}{00183}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Migration__Skeleton_a71668c68edcf35f36f111963a9b625df}{write}()
00184     \{
00185         $this->\hyperlink{classZendDbSchema__Db__Migration__Skeleton_a061e25b67825b88e94acf79944db19a6}{getFile}()->write();
00186 
00187         \textcolor{keywordflow}{return} $this;
00188     \}
00189 
\hypertarget{Skeleton_8php_source_l00195}{}\hyperlink{classZendDbSchema__Db__Migration__Skeleton_a9d8f00f78a02bdc4e028a210c2797c62}{00195}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Migration__Skeleton_a9d8f00f78a02bdc4e028a210c2797c62}{getClass}()
00196     \{
00197         \textcolor{keywordflow}{return} $this->\_class;
00198     \}
00199 
\hypertarget{Skeleton_8php_source_l00206}{}\hyperlink{classZendDbSchema__Db__Migration__Skeleton_a1d08bca816aaff3ac27087d5e5daa2ff}{00206}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Migration__Skeleton_a1d08bca816aaff3ac27087d5e5daa2ff}{getAdapter}()
00207     \{
00208         \textcolor{keywordflow}{if} (!$this->\_adapter) \{
00209             $adapter = \hyperlink{classZendDbSchema__Db__Schema__AbstractEntity_aeeb617d5d385796ccbe95e0aa85cf491}{ZendDbSchema\_Db\_Schema\_AbstractEntity::getDefaultAdapter}
      ();
00210             $this->\hyperlink{classZendDbSchema__Db__Migration__Skeleton_aa36d3a36801a4fe2dc5369f4fe68a516}{setAdapter}($adapter);
00211         \}
00212         \textcolor{keywordflow}{return} $this->\_adapter;
00213     \}
00214 
\hypertarget{Skeleton_8php_source_l00221}{}\hyperlink{classZendDbSchema__Db__Migration__Skeleton_aa36d3a36801a4fe2dc5369f4fe68a516}{00221}     \textcolor{keyword}{public} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Migration__Skeleton_aa36d3a36801a4fe2dc5369f4fe68a516}{setAdapter}(
      \hyperlink{interfaceZendDbSchema__Db__Adapter__SchemaCompatible}{ZendDbSchema\_Db\_Adapter\_SchemaCompatible}
       $adapter)
00222     \{
00223         $this->\_adapter = $adapter;
00224         \textcolor{keywordflow}{return} $this;
00225     \}
00226 
\hypertarget{Skeleton_8php_source_l00233}{}\hyperlink{classZendDbSchema__Db__Migration__Skeleton_a5846d949a449ef981b1c1e1be9eed03a}{00233}     \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Migration__Skeleton_a5846d949a449ef981b1c1e1be9eed03a}{getClassName}($version)
00234     \{
00235         \textcolor{keywordflow}{return} \textcolor{stringliteral}{'Migration\_'} . basename($version, \textcolor{stringliteral}{'.php'});
00236     \}
00237 
\hypertarget{Skeleton_8php_source_l00243}{}\hyperlink{classZendDbSchema__Db__Migration__Skeleton_a51234b84a2f9886f3e08d63519a6eb9d}{00243}     \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Migration__Skeleton_a51234b84a2f9886f3e08d63519a6eb9d}{generateVersion}()
00244     \{
00245         list($sec, $msec) = explode(\textcolor{stringliteral}{"."}, microtime(\textcolor{keyword}{true}));
00246         \textcolor{keywordflow}{return} date(\textcolor{stringliteral}{'Ymd\_His\_'}) . substr($msec, 0, 2);
00247     \}
00248 
\hypertarget{Skeleton_8php_source_l00254}{}\hyperlink{classZendDbSchema__Db__Migration__Skeleton_a1dabe0c3a95ba3b2f0a479ff1eee3351}{00254}     \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keyword}{function} \hyperlink{classZendDbSchema__Db__Migration__Skeleton_a1dabe0c3a95ba3b2f0a479ff1eee3351}{getFilename}($version)
00255     \{
00256         \textcolor{keywordflow}{return} $version . \textcolor{stringliteral}{'.php'};
00257     \}
00258 \}
\end{DoxyCode}
